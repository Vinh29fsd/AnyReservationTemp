@page "/"
@using AnyReservationTemp.Data
@using AnyReservationTemp.Domain
@using Microsoft.EntityFrameworkCore

@inject IDbContextFactory<AnyReservationTempContext> DbFactory

<PageTitle>Home</PageTitle>

<div class="image-container">
    <div class="text-overlay">AnyReservation</div>
</div>

<div class="marquee">
    <div class="marquee-content">
        @foreach (var restaurant in Restaurants)
        {
            <img src="@restaurant.ImagePath" alt="@restaurant.Name" class="brand">
        }

        <!-- Duplicate images for seamless looping -->
        @foreach (var restaurant in Restaurants)
        {
            <img src="@restaurant.ImagePath" alt="@restaurant.Name" class="brand">
        }
    </div>
</div>

<body>
    <div class="button-container justify-content-center">
        <a href="/reservations" class="glass-button bg-reserve"></a>
        <a href="/restaurants" class="glass-button bg-restaurants"></a>
    </div>
</body>

<!-- Filler -->
<div class="container-fluid d-flex flex-wrap w-100 py-2">
    <a style="color: #fff3f1;" class="btn px-4 py-2 m-2 rounded-pill" href="#">Space</a>
</div>

@code {
    private List<Restaurant> Restaurants { get; set; } = new();
    private AnyReservationTempContext context;

    protected override void OnInitialized()
    {
        context = DbFactory.CreateDbContext();

        // Fetch restaurants with images from the database
        Restaurants = context.Restaurant
            .Where(r => !string.IsNullOrEmpty(r.ImagePath)) // Ensures only restaurants with an image are loaded
            .ToList();
    }

    public async ValueTask DisposeAsync() => await context.DisposeAsync();
}
